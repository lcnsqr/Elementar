$(function(){$("body").click(function(){var a=$(".dropdown_items_listing").parents(".dropdown_items_listing_inline").first();$(".dropdown_items_listing:visible").fadeOut("fast")});$(".dropdown_items_listing_inline > a").live("click",function(a){a.preventDefault();var b=$(this).parent().find(".dropdown_items_listing").first();if(!$(b).is(":visible")){$(b).fadeIn("fast")}else{$(b).fadeOut("fast")}});$("#button_meta_save").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.post("/backend/content/xhr_write_meta",$(".noform").serialize(),function(b){if(b.done==true){showClientWarning(b.message)}else{showClientWarning(b.message)}$("#blocker").stop().fadeOut("fast")},"json")});$(".dropdown_items_listing_element_type_target").live("click",function(b){b.preventDefault();var c=$(this).attr("href");var a=$(this).html();if(c!="0"){$(this).parents(".dropdown_items_listing_inline").children("a:first").attr("href",c);$(this).parents(".dropdown_items_listing_inline").children("a:first").html(a)}});$("a#choose_element_type_for_parent_id").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");var b=$(this).attr("href");var c=$(this).parents("div:first").find(".dropdown_items_listing_inline").find("a:first").attr("href");if(c=="0"){$("a#element_type_create").trigger("click");return null}$.post("/backend/content/xhr_render_element_form",{parent_id:b,type_id:c},function(d){if(d.done==true){$("#type_define_new_container:visible").fadeOut("slow");$("#content_editors_container").replaceWith(d.html).show(function(){$("#content_editor_form").find("textarea").wysiwyg()})}else{showClientWarning(d.message)}$("#blocker").stop().fadeOut("fast")},"json")});$("#button_element_discard").live("click",function(a){a.preventDefault();$("#element_editor_form").hide("slow",function(){$("#element_editor_form").html("")})});$("#button_element_save").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.prepareCompositeFields();$.post("/backend/content/xhr_write_element",$(".noform").serialize(),function(c){if(c.done==true){var b=c.message;$.post("/backend/content/xhr_render_tree_unfold",{request:"element",id:c.element_id},function(d){$("#tree_listing_1").html(d.html)},"json");$.post("/backend/content/xhr_render_element_form",{id:c.element_id},function(d){if(d.done==true){$("#content_window").html(d.html).show(function(){$("#content_editor_form").find("textarea").wysiwyg();showClientWarning(b);$("#blocker").stop().fadeOut("fast")})}},"json")}else{$("#blocker").stop().fadeOut("fast");showClientWarning(c.message)}},"json")});$(".dropdown_items_listing_content_type_target").live("click",function(b){b.preventDefault();var c=$(this).attr("href");var a=$(this).html();if(c!="0"){$(this).parents(".dropdown_items_listing_inline").children("a:first").attr("href",c);$(this).parents(".dropdown_items_listing_inline").children("a:first").html(a)}});$("a#choose_content_type_for_parent_id").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");var b=$(this).attr("href");var c=$(this).parents("div:first").find(".dropdown_items_listing_inline").find("a:first").attr("href");if(c=="0"){$("a#content_type_create").trigger("click");return null}$.post("/backend/content/xhr_render_content_form",{parent_id:b,type_id:c,editor:"content"},function(d){if(d.done==true){$("#type_define_new_container:visible").fadeOut("slow");$("#content_editors_container").replaceWith(d.html).show(function(){$("#content_editor_form").find("textarea").wysiwyg()})}else{showClientWarning(d.message)}$("#blocker").stop().fadeOut("fast")},"json")});$("#button_content_discard").live("click",function(a){a.preventDefault();$("#content_editor_form").hide("slow",function(){$("#content_editor_form").html("")})});$(".file_erase").live("click",function(d){d.preventDefault();var a=$(this).parents(".file_item").first();$(a).find("input.upload_file").val("");var e=$(a).find(".file_item_thumbnail");$(e).addClass("file_item_thumbnail_missing");$(e).removeAttr("style");var g=$(this).attr("href");var c=$(a).parents(".file_field").first().find("input[name='"+g+"']");$(c).val("");var b=$(a).find("input[name='"+g+"_description']");$(b).val("");var f=$(a).find("ul.file_details");$(f).hide();$(f).find("span").html("")});$("#button_content_save").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.prepareCompositeFields();$.post("/backend/content/xhr_write_content",$(".noform").serialize(),function(c){if(c.done==true){var b=c.message;if(c.content_id!=1){$.post("/backend/content/xhr_render_tree_unfold",{request:"content",id:c.content_id},function(d){$("#tree_listing_1").html(d.html)},"json")}$.post("/backend/content/xhr_render_content_form",{id:c.content_id,editor:"content"},function(d){if(d.done==true){$("#content_window").html(d.html).show(function(){$("#content_editor_form").find("textarea").wysiwyg();showClientWarning(b);$("#blocker").stop().fadeOut("fast")})}},"json")}else{$("#blocker").stop().fadeOut("fast");showClientWarning(c.message)}},"json")});$(".pseudo_variables_menu_switcher").live("click",function(b){b.preventDefault();var a=$(this).parents(".pseudo_variables_menu").first().find(".pseudo_variables_accordion").first();if($(this).hasClass("collapsed")){$(a).slideDown("fast","easeOutSine");$(this).removeClass("collapsed");$(this).addClass("expanded")}else{$(a).slideUp("fast","easeInSine");$(this).removeClass("expanded");$(this).addClass("collapsed")}});$(".add_variable_single").live("click",function(c){c.preventDefault();var b=unescape($(this).attr("href"));var a=$(this).parents(".form_window_column_input").first().find(".template_textarea");$(a).insertAtCursor(b)});$(".add_variable_pair").live("click",function(c){c.preventDefault();var b=unescape($(this).attr("href"));var a=$(this).parents(".form_window_column_input").first().find(".template_textarea");$(a).insertAtCursor(b)});$.fn.extend({insertAtCursor:function(e){if(document.selection){$(this)[0].focus();sel=document.selection.createRange();sel.text=e}else{if($(this)[0].selectionStart||$(this)[0].selectionStart=="0"){var c=$(this)[0].selectionStart;var b=$(this)[0].selectionEnd;$(this)[0].value=$(this)[0].value.substring(0,c)+e+$(this)[0].value.substring(b,$(this)[0].value.length)}else{$(this)[0].value+=e}}var d=$(this)[0].value.substring(0,c).length+e.length;if($(this)[0].setSelectionRange){$(this)[0].focus();$(this)[0].setSelectionRange(d,d)}else{if($(this)[0].createTextRange){var a=$(this)[0].createTextRange();a.collapse(true);a.moveEnd("character",d);a.moveStart("character",d);a.select()}}}});$("a#content_type_create").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.post("/backend/content/xhr_render_content_type_form",function(b){if(b.done==true){$("#type_define_new_container").html(b.html).show("slow")}else{showClientWarning(b.message)}$("#blocker").stop().fadeOut("fast")},"json")});$("a#element_type_create").live("click",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.post("/backend/content/xhr_render_element_type_form",function(b){if(b.done==true){$("#type_define_new_container").html(b.html).show("slow")}else{showClientWarning(b.message)}$("#blocker").stop().fadeOut("fast")},"json")});$(".type_define_new_form").live("reset",function(a){a.preventDefault();$("#type_define_new_container").hide("slow",function(){$("#type_define_new_container").html("")})});$("#content_type_define_new_form").live("submit",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.post("/backend/content/xhr_write_content_type",$(this).serialize(),function(b){if(b.done==true){showClientWarning(b.message);$("#type_define_new_container").hide("slow",function(){var c=$("#choose_content_type_for_parent_id").attr("href");$.post("/backend/content/xhr_render_content_new",{id:c,type_id:b.type_id},function(d){if(d.done==true){$("#content_window").html(d.html).show()}$("#blocker").stop().fadeOut("fast")},"json")})}else{showClientWarning(b.message);$("#blocker").stop().fadeOut("fast")}},"json")});$("#element_type_define_new_form").live("submit",function(a){a.preventDefault();$("#blocker").fadeIn("fast");$.post("/backend/content/xhr_write_element_type",$(this).serialize(),function(b){if(b.done==true){showClientWarning(b.message);$("#type_define_new_container").hide("slow",function(){$("#type_define_new_container").html("")});var c=$("#choose_element_type_for_parent_id").attr("href");$.post("/backend/content/xhr_render_element_new",{id:c,type_id:b.type_id},function(d){if(d.done==true){$("#content_window").html(d.html).show()}$("#blocker").stop().fadeOut("fast")},"json")}else{showClientWarning(b.message);$("#blocker").stop().fadeOut("fast")}},"json")});$("a#add_type_field").live("click",function(c){c.preventDefault();var h=$("#type_define_new_field_0").clone();var a=$(h).find("label[for='field_0']");var e=$(h).find("#field_0");var f=$(h).find("label[for='field_type_0']");var d=$(h).find("#field_type_0");var g=$("#type_define_new_container").find(".type_define_new_field").length;$(h).attr("id","type_define_new_field_"+g);$(a).attr("for","field_"+g);$(e).attr("id","field_"+g);$(e).attr("name","field_"+g);$(e).attr("value","");$(f).attr("for","field_type_"+g);$(d).attr("id","field_type_"+g);$(d).attr("name","field_type_"+g);$(h).css("display","none");$(this).before(h);$(h).show("slow");var b=$("#type_define_new_container").find(".type_define_new_field").length;$("#type_define_new_container").find("input[name='field_count']").val(b)});$("a.content_editors_menu_item").live("click",function(a){a.preventDefault();var b=$(this).attr("href");$("a.content_editors_menu_item[href!='"+b+"']").removeClass("current");$(this).addClass("current");$("div.editor_form[id!='"+b+"']").hide();$("div.editor_form[id='"+b+"']").show()});$("form.template_form").live("submit",function(b){b.preventDefault();$("#blocker").fadeIn("fast");var a=true;var c=$(this).find('input[name="template_sole"]').first();if(!$(c).attr("checked")&&$(c).length>0){a=confirm("Sobrescrever template padrão?")}var d=$(this).find(".template_textarea");$.post("/backend/content/xhr_write_template",$(this).serialize()+"&overwrite="+a,function(e){if(e.done==true){showClientWarning(e.message)}else{showClientWarning(e.message)}$("#blocker").stop().fadeOut("fast")},"json")});$(".input_lang_tab_link").live("click",function(c){c.preventDefault();var a=$(this).attr("href");var b=$(this).parents(".form_window_column_input").first();$(b).find("a.input_lang_tab_link.current").removeClass("current");$(this).addClass("current");$(b).children(".input_lang_field:visible").hide();$(b).children(".input_lang_field_"+a).show()});$(".browse_file").live("click",function(b){b.preventDefault();var a=$(this).attr("href");window.open("/backend/file/manager?parent=direct&identifier="+a,"_blank","height=480, width=880")})});$.extend({prepareCompositeFields:function(){$("input.file").each(function(){var a=$.parseJSON($(this).val());if(a!=null){a.title=$("input#"+$(this).attr("id")+"_description").val()}$(this).val($.toJSON(a))});$(".file_gallery_field").each(function(){$(this).prepareFileGalleryField()});$(".menu_field").each(function(){$(this).prepareMenuField()});$(".youtube_gallery_field").each(function(){$(this).prepareYoutubeGalleryField()})}});