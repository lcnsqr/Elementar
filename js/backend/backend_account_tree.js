$(function(){$("body").click(function(){$("body > .tree_listing_menu").fadeOut("fast",function(){$(this).remove()});$(".label > a.current").removeClass("current")});$(".label > a").live("click",function(b){b.preventDefault();$("body > .tree_listing_menu").fadeOut("fast",function(){$(this).remove()});$(".label > a.current").removeClass("current");$(this).addClass("current");var a=$(this).parents(".tree_listing_row").first().find(".tree_listing_menu");var e=$(a).clone();var d=-20;var c=5;$(e).css({left:(b.pageX+c)+"px",top:(b.pageY+d)+"px"});$("body").append(e);$(e).fadeIn("fast")});$(".label > a").live("mousedown",function(a){a.preventDefault()});$("a.fold.folder_switch").live("click",function(c){c.preventDefault();$("#account_tree_loading").fadeIn("fast");var b=$(this).attr("href");var d=$(this).parents(".tree_parent").first().find(".tree_listing").first();var a=$(this);$.post("/backend/account/xhr_render_group_listing",{group_id:b},function(e){if(e.done==true){$(d).html(e.html);$(d).slideDown("fast","easeInSine");$(a).addClass("unfold");$(a).removeClass("fold")}$("#account_tree_loading").fadeOut("fast")},"json")});$("a.unfold.folder_switch").live("click",function(a){a.preventDefault();var b=$(this).parents(".tree_parent").first().find(".tree_listing").first();$(b).slideUp("fast","easeOutSine");$(this).addClass("fold");$(this).removeClass("unfold")});$("a.new.group,a.edit.group").live("click",function(b){b.preventDefault();$("#blocker").fadeIn("fast");if($(this).hasClass("new")){var a=""}else{if($(this).hasClass("edit")){var a=$(this).attr("href")}}$.post("/backend/account/xhr_render_group_form",{group_id:a},function(c){if(c.done==true){$("#account_window").html(c.html).show()}$("#blocker").stop().fadeOut("fast")},"json")});$("a.new.account,a.edit.account").live("click",function(c){c.preventDefault();$("#blocker").fadeIn("fast");if($(this).hasClass("new")){var b=$(this).attr("href");var a=""}else{if($(this).hasClass("edit")){var b="";var a=$(this).attr("href")}}$.post("/backend/account/xhr_render_account_form",{group_id:b,account_id:a},function(d){if(d.done==true){$("#account_window").html(d.html).show()}$("#blocker").stop().fadeOut("fast")},"json")});$("a.remove").live("click",function(d){d.preventDefault();if($(this).hasClass("group")){var e="/backend/account/xhr_erase_group"}else{if($(this).hasClass("account")){var e="/backend/account/xhr_erase_account"}}$("#blocker").fadeIn("fast");var f=$(this).attr("href");var b=$("#tree_listing_1").find('p.label > a[href="'+f+'"]').parents(".tree_parent").first();var a=$(b).parents(".tree_listing").first();var c=$(b).parents(".tree_parent").first();if(confirm($(this).attr("title")+"?")){$.post(e,{id:f},function(g){if(g.done==true){$(b).slideUp("fast","easeOutSine",function(){$(this).remove();if($(a).children().length==0){$(a).hide();$(c).find(".tree_listing_bullet").first().html('<span class="bullet_placeholder">&nbsp;</span>')}})}showClientWarning(g.message);$("#blocker").stop().fadeOut("fast")},"json")}else{$("#blocker").stop().fadeOut("fast")}});$(window).mousedown(function(a){mouseButton=1});$(window).mouseup(function(d){mouseButton=0;if($("#tree_drag_container").children().length>0){var e=$("#tree_drag_container").find("p.label").first();var b=$(e).children("a").attr("href");$("#tree_drag_container").fadeOut("fast",function(){$("#tree_drag_container").html("");$("#tree_drag_container").hide()});var a=$(".tree_listing_row.hover").find("p.label").first();var c=$(a).children("a").attr("href");$(".tree_listing_row").not(".undroppable").not(".droppable").addClass("droppable");$(".tree_listing_row.hover").removeClass("hover");if(!c||!b){return null}$("#account_tree_loading").fadeIn("fast");$.post("/backend/account/xhr_write_account_group",{group_id:c,account_id:b},function(f){if(f.done==true){$.post("/backend/account/xhr_render_tree_listing",{group_id:f.group_id},function(g){$("#tree_listing_1").html(g.html);$("#account_tree_loading").fadeOut("fast")},"json")}else{$("#account_tree_loading").fadeOut("fast");showClientWarning(f.message)}},"json")}});$(window).mousemove(function(b){if(mouseButton==1&&$("#tree_drag_container").children().length>0){$("#tree_drag_container:hidden").fadeIn("fast");$("#tree_drag_container").css("top",(b.pageY-offsetY)+"px");$("#tree_drag_container").css("left",(b.pageX-offsetX)+"px");var a=b.pageY;var c=b.pageX;$(".tree_listing_row.droppable").not(".dragging").each(function(){var e=$(this).offset().top;var f=$(this).offset().left+$(this).outerWidth();var d=$(this).offset().top+$(this).outerHeight();var g=$(this).offset().left;if(a>e&&c<f&&a<d&&a>g){$(this).addClass("hover")}else{$(this).removeClass("hover")}})}});$(".tree_listing_icon.draggable").live("mousedown",function(b){b.preventDefault();var d=$(this).parent(".tree_listing_row");if($(d).parent("#tree_parent_1").length>0){return null}var c=$(d).offset();offsetY=b.pageY-c.top;offsetX=b.pageX-c.left;$(d).removeClass("droppable");var a=$(d).clone();$(a).addClass("dragging");$(a).children().addClass("dragging");$("#tree_drag_container").html(a)})});var offsetY=0;var offsetX=0;var mouseButton=0;